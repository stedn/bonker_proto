---
layout: post
title: Quantum Coin Flip Device
date: '2019-10-18T22:58:00.000-07:00'
author: Will Stedden
tags:
- Physics
- Electronics
modified_time: '2019-10-18T22:58:33.707-07:00'
image: https://2.bp.blogspot.com/-2t52RMTXdAU/XaopNS-HFaI/AAAAAAAAE2Q/ekmM-lhYz4sUgY3ZhB_2a41jkuDFOKU0ACLcBGAsYHQ/s72-c/circuit-20191018-0928.png
blogger_id: tag:blogger.com,1999:blog-40405577383217050.post-4995626960754429292
blogger_orig_url: https://www.bonkerfield.org/2019/10/quantum-coin-flip-device.html
---

<p>Over the past few months, I've been working on building tools to connect human decisions with the outcomes of quantum measurements.  The goal is to allow people to let their decisions be chosen using the <a href="https://en.wikipedia.org/wiki/Many-worlds_interpretation">many-worlds interpretation</a> of quantum mechanics, which will end up creating parallel realities where all outcomes occur.  You can read <a href="/2019/10/quantum-multiverse-bifurcator.html">this post</a> to learn more about the idea and how I built a web-based <a href="https://quantum-multiverse-bifurcator.appspot.com">Quantum Multiverse Bifurcator</a>.</p> <p>The main drawback of my webapp is that it relies on being connected to the internet to request a quantum measurement from <a href="https://qrng.anu.edu.au">an experiment</a> being run by this <a href="https://www.cqc2t.org">quantum computation research group</a> in Australia. Ideally, I'd like to be able to make such a quantum measurement myself to make it more accessible wherever <a href="https://journal.burningman.org/2019/10/philosophical-center/the-theme/burning-man-2020-the-multiverse/">I go</a>.</p> <p>There are <a href="https://en.wikipedia.org/wiki/Hardware_random_number_generator#Quantum_random_properties">many examples</a> of various quantum measurement devices on the web, but most of them are more sophisticated and would be fairly expensive to build. All I need is a device that can make a simple binary measurement from the outcome of a quantum event. So I set about trying to design something cheap and simple that still maintains true quantum randomness.</p> <h4>Concept</h4><p>The simplest kind of quantum measurement is probably <a href="https://www.rp-photonics.com/shot_noise.html">shot noise</a>, or the variability in the number of photons detected when measuring light with a <a href="https://en.wikipedia.org/wiki/Photodetector">photodetector</a>. A photodetector is just any device that absorbs light and converts the light it absorbs into an electrical signal.  Photodetectors are used in a bunch of things, like if you've ever seen a nightlight that only turns on when its dark, or if you've ever seen your phone/computer automatically adjust its brightness.  </p> <p>The reason that this is a quantum measurement is that the light field that is being absorbed exhibits quantum fluctuations, which cause the number of photons present to vary.  Therefore, the exact amount of electricity generated by the photodetector is also varying slightly even if the average amount of light stays the same.  To detect the quantum effect one needs to observe the variability in the electrical signal of the photodetector.</p> <p>Unfortunately, measuring the exact electrical signal with the kind of sensitivity needed to pick up on the quantum signals normally takes a pretty sophisticated device.  That would be costly and make this measurement device a little impractical.  So I wanted to simplify the machinery needed to make this measurement.</p> <p>Given that I only really need to generate a <a href="https://www.lexico.com/en/definition/binary">binary</a> outcome (a coin flip), I knew that I could get away with a circuit that just goes on when the measurement is beyond some threshold. The catch is that its a little bit difficult to calibrate exactly where the cutoff should be. In addition, it's possible that the source of the variability could be non-quantum if the device isn't set up properly. There are many other sources of apparent randomness that don't come from quantum mechanics and I wanted to make sure to isolate my system from those.</p> <p>To alleviate these issues, the design I chose actually creates two quantum measurements of the shot noise from two photodetectors.  It then compares the signal from each measurement at a specific point in time and either turns on or off an LED depending on which measurement is greater.  This allows for the circuit to really only use 4 components while still transmitting a quantum signal to a binary outcome.</p> <p>The last important thing is that you need to be able to control for the variation in the electrical components of the circuit, which could affect the measurement but are non-quantum. To control for this, I can calibrate the amount of light hitting each photodetector to make the measurement go either way with almost exactly 50% probability.  And the amount of light can be lowered further and further to turn down the contribution of classical effects on the randomness.</p> <p>With this basic concept, the only thing left to do was to try to build it. </p> <h4>Circuit</h4> <p>After asking both <a href="https://physics.stackexchange.com/questions/488133/how-to-build-a-circuit-that-generates-a-quantum-coin-flip">physics</a> and <a href="https://electronics.stackexchange.com/questions/445338/circuit-to-randomly-light-one-led-or-another/447272">electronics</a> stack exchanges with little results, I came up with the following circuit </p> <div class="separator" style="clear: both; text-align: center;"><a href="https://www.falstad.com/circuit/circuitjs.html?cct=$%201%200.000005%2010.634267539816555%2050%205%2050%0Aa%20256%20240%20336%20240%208%205%200%201000000%200.7831537737346073%200.7001096127683933%20100000%0AR%20176%20128%20144%20128%200%200%2040%205%200%200%200.5%0At%20144%20192%20176%20192%200%201%20-4.336216318433491%20-0.11937009216809913%20100%0At%20160%20272%20192%20272%200%201%20-4.419260479399706%20-0.11937009216809924%20100%0Aw%20176%20208%20256%20224%200%0Aw%20240%20128%20176%20176%200%0Aw%20240%20128%20240%20240%200%0AR%20144%20192%20128%20192%200%206%2040%200.5%200.5%200%200.5%0AR%20160%20272%20128%20272%200%206%2040%200.5%200.5%200%200.5%0Aw%20192%20288%20256%20256%200%0As%20240%20128%20336%20128%200%201%20false%0Aw%20192%20256%20240%20240%200%0A155%20336%20240%20400%20176%200%205%0Aw%20336%20128%20336%20272%200%0Aw%20240%20128%20176%20128%200%0A162%20432%20240%20512%20240%202%20default-led%201%200%200%200.01%0A162%20432%20304%20480%20304%202%20default-led%201%200%200%200.01%0Aw%20512%20240%20512%20304%200%0Ar%20512%20304%20512%20352%200%20100%0Ag%20512%20352%20512%20368%200%0Ag%20480%20352%20480%20368%200%0Ar%20480%20352%20480%20304%200%20100%0Ax%20120%20316%20336%20319%204%2012%20%5Enoise%5Csto%5Cstransistors%5Cs%5Cq%5Csphotodiodes%0A" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-2t52RMTXdAU/XaopNS-HFaI/AAAAAAAAE2Q/ekmM-lhYz4sUgY3ZhB_2a41jkuDFOKU0ACLcBGAsYHQ/s1600/circuit-20191018-0928.png" data-original-width="532" data-original-height="340" /></a></div> <p>To view the circuit in simulation go <a href="https://www.falstad.com/circuit/circuitjs.html?cct=$%201%200.000005%2010.634267539816555%2050%205%2050%0Aa%20256%20240%20336%20240%208%205%200%201000000%200.7831537737346073%200.7001096127683933%20100000%0AR%20176%20128%20144%20128%200%200%2040%205%200%200%200.5%0At%20144%20192%20176%20192%200%201%20-4.336216318433491%20-0.11937009216809913%20100%0At%20160%20272%20192%20272%200%201%20-4.419260479399706%20-0.11937009216809924%20100%0Aw%20176%20208%20256%20224%200%0Aw%20240%20128%20176%20176%200%0Aw%20240%20128%20240%20240%200%0AR%20144%20192%20128%20192%200%206%2040%200.5%200.5%200%200.5%0AR%20160%20272%20128%20272%200%206%2040%200.5%200.5%200%200.5%0Aw%20192%20288%20256%20256%200%0As%20240%20128%20336%20128%200%201%20false%0Aw%20192%20256%20240%20240%200%0A155%20336%20240%20400%20176%200%205%0Aw%20336%20128%20336%20272%200%0Aw%20240%20128%20176%20128%200%0A162%20432%20240%20512%20240%202%20default-led%201%200%200%200.01%0A162%20432%20304%20480%20304%202%20default-led%201%200%200%200.01%0Aw%20512%20240%20512%20304%200%0Ar%20512%20304%20512%20352%200%20100%0Ag%20512%20352%20512%20368%200%0Ag%20480%20352%20480%20368%200%0Ar%20480%20352%20480%20304%200%20100%0Ax%20120%20316%20336%20319%204%2012%20%5Enoise%5Csto%5Cstransistors%5Cs%5Cq%5Csphotodiodes%0A">here</a>.  On the simulation site each time you close the switch one of the LEDs should light randomly.  Below I will walk through each of the subcomponents in a little more detail.</p> <h6>Step 1. Generate slightly varying voltages from two photodiodes</h6><p>The first step is to make a very simple photodetectors using <a href="https://www.rp-photonics.com/photodiodes.html">photodiodes</a>.  The photodiodes act like little dams that prevent the flow of electricity (called <a href="https://en.wikipedia.org/wiki/Electric_current">current</a>), but which let more electricity through when light is shined on them.  </p> <div class="separator" style="clear: both; text-align: center;"><a href="https://www.electrical4u.com/images/2018/november18/characteristics-of-photodiode.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://www.electrical4u.com/images/2018/november18/characteristics-of-photodiode.jpg" width="400" height="400" data-original-width="450" data-original-height="450" /></a></div> <p>In the circuit, I connect the photodiode to a between the plus and minus ends of the battery with a resistor after it.   This causes there to be a voltage across the resistor, which then fluctuates as the light hitting the photodiode varies.   At low enough light, the variation is mostly quantum mechanical in nature.</p> <div class="separator" style="clear: both; text-align: center;"><a href="https://www.pinterest.com/pin/619174648742551036/?nic=1" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-vrjicbdG99Y/XaotTVs0WGI/AAAAAAAAE2c/2IiRoRS7Dt4Byzgx1EAgbKr7U9RWYIXrQCLcBGAsYHQ/s400/0b07d078681096482698fbe614ec5890.png" width="310" height="400" data-original-width="398" data-original-height="514" /></a></div> <p>One important point is that there can also be classical noise in this type of circuit, largely due to thermal noise changing the resistivity of the resistor.  To overcome this, I got a tip from a physicist friend of mine to use a very large resistor.  This should ensure that the thermal variation is small relative to the variation from the quantum effects in the photodiode. </p> <p><small>*Note: When I built the circuit simulation on <a href="http://falstad.com/circuit/circuitjs.html">falstad's circuit simulator</a>, I wasn't able to put in a photodiode directly. Instead, I mocked those components using a transistor and random noise source.  The rest of the simulation circuit looks like the real prototype though.</small></p> <h6>Step 2. Comparing the photodetectors</h6> <p>The next part of the circuit performs an amplification of the signal difference between the two photodetectors.  This is accomplished using an <a href="https://www.electronics-tutorials.ws/opamp/op-amp-comparator.html">op-amp comparator</a>.   The comparator is a widely available circuit that works to </p> <div class="separator" style="clear: both; text-align: center;"><a href="https://www.electronics-tutorials.ws/opamp/op-amp-comparator.html" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-MNRTKWnK8NY/Xaova_ksN-I/AAAAAAAAE2o/HjwEiXOWY6kYOUlyls_xolP-FtT2zHIfwCLcBGAsYHQ/s400/opamp-opamp103.gif" width="400" height="185" data-original-width="436" data-original-height="202" /></a></div> <p>So whenever the first photodiode's voltage is just slightly higher than the second one's voltage, the output of the comparator is high (+3 volts in my circuit).  And whenever the second signal is higher the voltage goes low (0V in my circuit).  This signal is varying all the time though as the two detectors vary back and forth.  So to persist the measurement we need one more component.</p>  <h6>The D-Latch (flip-flop)</h6><p>Given a time varying voltage, we need a way to detect whether the voltage is high or low at one instant and then persist that value for a long period of time.  There are a number of ways to do this, but one of the simplest is with a "<a href="https://en.wikibooks.org/wiki/Digital_Circuits/Latches">latch</a>" circuit. There are many kinds of latches, but they all take an input and then hold an output value until the circuit is reset.</p> <div class="separator" style="clear: both; text-align: center;"><a href="http://electronicsgurukulam.blogspot.com/2012/05/animation-of-master-d-flip-flop.html" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://1.bp.blogspot.com/-mz99UoGkeYc/Xao3fsIh0eI/AAAAAAAAE3A/ovfkl2lejd8OjD58kuJYPqRujPXBuCzzgCLcBGAsYHQ/s400/dtype01.gif" width="400" height="252" data-original-width="379" data-original-height="239" /></a></div> <p>I used a <a href="https://en.wikipedia.org/wiki/Flip-flop_(electronics)#Gated_D_latch">D-Latch</a>, which takes an input signal and stores it at the moment a "trigger" input is pushed.  Then the D-Latch holds that value and outputs it until the trigger is pushed again. The output is referred to as Q in the diagram. In addition, most D-Latches also output the opposite of Q (called Q') at the same time. </p> <div class="separator" style="clear: both; text-align: center;"><a href="https://en.wikipedia.org/wiki/Flip-flop_(electronics)#Gated_D_latch" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://1.bp.blogspot.com/-ZoMUSnQDGR8/XaoxiLzKdoI/AAAAAAAAE20/JTYAPEnFZ4o1bpRlm1FzTYPk9sFeNv5_gCLcBGAsYHQ/s400/Screenshot%2Bfrom%2B2019-10-18%2B14-41-08.png" width="400" height="134" data-original-width="502" data-original-height="168" /></a></div> <p>The signal for my D-Latch was just the output from the comparator.  I had a manual switch that set the trigger.  If the output from the comparator is high when the trigger is pushed, then the D-Latch will hold Q at high and Q' at low.  If the output from the comparator is low, then the D-Latch will hold Q low.  The circuit will keep it at that level until the trigger is pushed again, at which point, it will hold the signal based on the output from the comparator at that point. </p>   <h6>Output</h6><p>To vizualize the output of the D-Latch I just added a pair of LEDs to the end.  When the Q output is high, the red LED lights, and when Q' is high, the blue one lights.  </p>  <h4>Parts List</h4><p>I decided to go with a 3.3V design because the parts I could find worked out better that way (price wise).  I bought these specific parts for each of the above components. This is not an endorsement of any vendor by the way. Also some of them were NOT the right parts for the reasons listed below, but this should point you in the right direction.</p><ul><li>photodiodes: <a href="https://www.amazon.com/gp/product/B00M1PMHO4/">HiLetgo 20pcs 5MM Photodiode Photosensitive Diode Light Sensitive Diode Round F5 Photodiode 3V</a></li> <li>op-amp: <a href="https://www.mouser.com/ProductDetail/on-semiconductor/ncs325sn2t1g/?qs=dbuNSGnowt2g9SoYxOxXaw%3D%3D">ON Semiconductor NCS325SN2T1G</a></li> <li>flip-flop: <a href="https://www.mouser.com/ProductDetail/nexperia/74aup1g79gv125/?qs=jquClx72t9COASqZ9WZ81A%3D%3D">Nexperia 74AUP1G79GV,125</a></li> <li>leds: <a href="https://www.mouser.com/ProductDetail/inolux/inl-3ab30/?qs=qSfuJ%252bfl%2Fd4rOSt45g1Ezg%3D%3D">Inolux INL-3AB30</a></li> <li>boards: <a href="https://www.amazon.com/gp/product/B07CJ96ZPW/">QLOUNI 40pcs PCB Proto Boards SMD to DIP Adapter</a></li><li><a href="https://www.amazon.com/gp/product/B00FO9HQLS/">3V watch batteries</a> and <a href="https://www.amazon.com/gp/product/B01J5FY2GI/">holders</a></li></ul> <h4>Prototype 1</h4> <p>Since I bought such small components for the D-latch and op-amp, I needed to solder them onto a board to make connections to the other components.  The solder work was painstakingly tiny, but you can see that each of the legs connects to a metal strip that would then connect to a through-hole.</p> <div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-fL8oEk2ahoo/Xao33wOrxuI/AAAAAAAAE3I/pV1DGLzKDnQrFbFRE_47IAKttrpDOczNQCKgBGAsYHg/s1600/IMG_20190728_155527.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-fL8oEk2ahoo/Xao33wOrxuI/AAAAAAAAE3I/pV1DGLzKDnQrFbFRE_47IAKttrpDOczNQCKgBGAsYHg/s400/IMG_20190728_155527.jpg" width="400" height="300" data-original-width="1600" data-original-height="1200" /></a></div> <p>I wired up the comparator and D-Latch part of the system as displayed in the diagram above.  That way I could isolate those with known signals from the part of the circuit that would be the photodiodes.  The D-Latch and LEDs tested and worked correctly. </p><div class="separator" style="clear: both; text-align: center;"><a href="https://3.bp.blogspot.com/-bbg5zYbghlE/Xao4leY2xrI/AAAAAAAAE3U/sCWgzEnR7EEZmbGzuVmPFwG6CciGhXR0gCKgBGAsYHg/s1600/IMG_20190728_155120.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://3.bp.blogspot.com/-bbg5zYbghlE/Xao4leY2xrI/AAAAAAAAE3U/sCWgzEnR7EEZmbGzuVmPFwG6CciGhXR0gCKgBGAsYHg/s400/IMG_20190728_155120.jpg" width="300" height="400" data-original-width="1200" data-original-height="1600" /></a></div><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-bLiAyAkP_GM/Xao4lZaGMkI/AAAAAAAAE3U/Ti_YIQIw6zIIJanmJ30ckw1QVdqkfS7WQCKgBGAsYHg/s1600/IMG_20190728_174343.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://2.bp.blogspot.com/-bLiAyAkP_GM/Xao4lZaGMkI/AAAAAAAAE3U/Ti_YIQIw6zIIJanmJ30ckw1QVdqkfS7WQCKgBGAsYHg/s400/IMG_20190728_174343.jpg" width="300" height="400" data-original-width="1200" data-original-height="1600" /></a></div>  <p>The next step was to connect the two photodiodes and resistors into the circuit.  They sort of look like LEDs but they are photodiodes (LED and photodiodes are very similar materials just with the direction of conversion from light to electricity backwards). I aimed to make the two photodiode segments of the circuit as symmetric as possible to get them close to the similar state.  With them wired up, the system is easy to calibrate by just rotating them towards a common light source until the odds of both outcomes is ~50%.</p> <div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-DU6EqrK1XNM/Xao33_aLvUI/AAAAAAAAE3I/IxgvVzAwIF4okKZH-owmqlzirJjy5SmMgCKgBGAsYHg/s1600/IMG_20191018_134423.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-DU6EqrK1XNM/Xao33_aLvUI/AAAAAAAAE3I/IxgvVzAwIF4okKZH-owmqlzirJjy5SmMgCKgBGAsYHg/s400/IMG_20191018_134423.jpg" width="400" height="300" data-original-width="1600" data-original-height="1200" /></a></div> <p>For the final step, I just soldered in the output LED. The whole circuit is a bit of a mess, but it was functional at least. </p> <div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-5O4lsbKNg0E/Xao335j77hI/AAAAAAAAE3I/K-0ZvVmq9LYZ95kEodYsv5YL7koknAPSwCKgBGAsYHg/s1600/IMG_20191018_134403.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" src="https://4.bp.blogspot.com/-5O4lsbKNg0E/Xao335j77hI/AAAAAAAAE3I/K-0ZvVmq9LYZ95kEodYsv5YL7koknAPSwCKgBGAsYHg/s400/IMG_20191018_134403.jpg" width="400" height="300" data-original-width="1600" data-original-height="1200" /></a></div> <p>I am looking to build a couple more iterations that are a little cleaner.  When I've built them, I will update here with details of the operation, and how to calibrate them.</p>