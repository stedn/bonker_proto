<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Simulating the Braccio robotic arm with ROS and Gazebo | bonkerfield</title><meta name="description" content="just your standard information identity spacetime field"><meta itemprop="name" content="will stedden"><meta itemprop="description" content="just your standard information identity spacetime field"><meta itemprop="image" content="https://bonkerfield.org/assets/images/2020/braccio_pick_demo.gif"><meta property="og:url" content="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"><meta property="og:type" content="website"><meta property="og:title" content="Simulating the Braccio robotic arm with ROS and Gazebo | bonkerfield"><meta property="og:site_name" content="bonkerfield"><meta property="og:description" content="just your standard information identity spacetime field"><meta property="og:image" content="https://bonkerfield.org/assets/images/2020/braccio_pick_demo.gif"><meta property="twitter:url" content="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:title" content="Simulating the Braccio robotic arm with ROS and Gazebo | bonkerfield"><meta property="twitter:site" content="bonkerfield"><meta property="twitter:description" content="just your standard information identity spacetime field"><meta property="twitter:creator" content="@bonkerfield"><meta property="twitter:image" content="https://bonkerfield.org/assets/images/2020/braccio_pick_demo.gif"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="bonkerfield" href="/feed.xml"><link rel="canonical" href="/2020/08/braccio-moveit-gazebo/"><link href="https://fonts.googleapis.com/css?family=Exo" rel="stylesheet"><link rel="webmention" href="https://webmention.io/bonkerfield.org/webmention" /><link rel="pingback" href="https://webmention.io/bonkerfield.org/xmlrpc" /> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132451521-2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-132451521-2'); </script><link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css' rel='stylesheet'/></head><body id="simulating-the-braccio-robotic-arm-with-ros-and-gazebo" class="post-layout"><header class="header"> <span><sup><a class="header__leadin" href="https://will.stedden.org">will.stedden ></a> </sup> <a class="header__title" href="/">bonkerfield</a></span><nav><ul class="header__list"><li><a href="/things">things</a></li><li><a href="/doings">doings</a></li><li><a href="/reasons">reasons</a></li><li><a href="https://viewfoil.bonkerfield.org/"><i class="fa fa-envelope"></i></a></li><li><a href="/search"><i class="fa fa-search"></i></a></li></ul></nav></header><a style="display:none;" class="p-author h-card" href="http://bonkerfield.org"> <img alt="" src="/assets/images/main/face_prof.jpg"/> will stedden</a><main class="bonk"><div class="post"><article class="h-entry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding-half"><div class="grid-small"><h2 itemprop="name headline p-name">Simulating the Braccio robotic arm with ROS and Gazebo</h2><time class="post__date dt-published" datetime="2020-08-12T00:00:00-07:00" itemprop="datePublished">2020·08·12</time> <span class="post__author"> | <a class="p-name u-url" href="http://will.stedden.org" title="about">will stedden</a> </span><p class="post__description p-summary"></p><a class="u-url" style="display:none;" href="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"></a></div></div><div class="post__content section-padding"><div class="grid"><div class="e-content" id="markdown" itemprop="articleBody"><p> As I'm continuing to build my <a href="/su_chef"><code>su_chef</code> robotic food prep project</a>, I've realized it will be more efficient to design and prototype using robotics simulations. So last weekend, I took a deep dive into integrating motion planning via <a href="https://moveit.ros.org/">ROS MoveIt</a> with the <a href="http://gazebosim.org/">Gazebo physics simulator</a> using a virtual model of my <a href="https://store.arduino.cc/usa/tinkerkit-braccio">Arduino Braccio</a> arm. Using these tools, I'm able to simulate my robot interacting with objects to quickly test how it will work without needing to have my physical setup running.</p><p> In this demo, you can see the arm grabbing and moving the red block and the blue bowl.</p><img src="/assets/images/2020/braccio_pick_demo.gif" alt="Simulated robot arm moves red block and blue bowl around."/><p> The red block is a stand-in for the vegetables that I will eventually want the <code>su_chef</code> to pick for chopping. Rolling down a ramp into a bowl is a major simplification of the actual process, but I thought I would first make a simplified package so that others could reuse it and have an easier time getting started simulating with the Braccio arm and Gazebo.</p><p> I wasn't able to find anyone else's working simulator for the Braccio so I combined <a href="https://github.com/CesMak/kuka_arm">bits</a> from <a href="https://github.com/berkeleyopenarms/blue_moveit">several</a> <a href="https://github.com/jonabalzer/braccio_moveit_config">other</a> <a href="https://github.com/dpakshimpo/braccio-study">examples</a> I found. I built a very bare-bones command line program that controls the robotic simulator to make it easier to use right off the bat.</p><img class="small_img" src="/assets/images/2020/cmd_line_welcome.png" alt="ASCII splash screen for Arduino Braccio Pick+Drop Simulator."/><p> If you'd like to jump into using it, the code and instructions are <a href="https://github.com/lots-of-things/braccio_moveit_gazebo">available here</a>. Below I've describe how arm is able to determine where to pick up, as well as some testing I did to see how often the arm succeeds at its task.</p><h4>The Inverse Kinematics solver</h4><p> Since the Braccio arm is fairly small and simple, it has a limited domain where it's able to pick up items. To overcome this, I needed to program the ability to pick up from above and from the side, as well as subroutines that reposition the block if it's outside of the graspable region.</p><p> The problem is that the arm itself is controlled by its joint angles so there is no direct way to tell it to go to a certain point in space. Instead, I had to compute what the arm's angles should be given a target location and orientation. Working out the direction to turn the arm's base is fairly easy, but it is more difficult to figure out how to adjust the shoulder, elbow, and wrist angles to get to a specific distance from the base, labeled <i>r</i> in this image.</p><img src="/assets/images/2020/braccio_dimensions.png" alt="Braccio arm calculations" /><p> In my <a href="/2020/07/su-chef-braccio-yolo/">previous version</a> I just hard coded the equation to determine the angles needed for a given position. However, this isn't ideal because (a) it's a lot of messy math to debug, and (2) this limits me to exactly 1 solution when really there are many acceptable solutions within a small window around the exact solution. To do this more generally, I needed an <a href="https://en.wikipedia.org/wiki/Inverse_kinematics#:~:text=In%20computer%20animation%20and%20robotics,the%20start%20of%20the%20chain.">inverse kinematics</a> (IK) solver. There are existing robotic arm inverse kinematics solvers, but most of them work on 6 degree-of-freedom (DOF) arms, while the Braccio only has 5 DOF. This doesn't sound like a huge difference, but it means that the Braccio is actually highly constrained in the range of poses that it can take, which breaks most standard IK solvers.</p><p> So for this attempt, I switched to using a simple 2D IK solver based on <a href="https://studywolf.wordpress.com/2013/04/11/inverse-kinematics-of-3-link-arm-with-constrained-minimization-in-python/">this post</a> from <a href="https://twitter.com/northproof">Travis DeWolf</a>. This solver aims to get the arm as close to the target point as posibble while maintaining allowed angle restrictions and certain height restrictions to keep it the right distance from the ground. If you'd like to know more about how it works, I suggest Travis's <a href="https://studywolf.wordpress.com/2013/04/11/inverse-kinematics-of-3-link-arm-with-constrained-minimization-in-python/">blog post</a> or check out <a href="https://github.com/lots-of-things/braccio_moveit_gazebo/blob/965d95dbb96f9e418582252e8bc2ea056ab9b532/braccio_moveit_gazebo/scripts/target_object_sim.py#L477">the working solver code</a> in my simulation package.</p><h4>Performance</h4><p> It took a few days of fine-tuning and retesting to get both the physics and the robot measurements worked out to the point where it was working consistently. Once I had it working somewhat consistently, I collected data on many trials sequentially to see how it performs. I reset the block to random positions, and then attempt to pick it it up.</p><p> For the "top" picker the success rate was about 50%, while for the "side" picker it was only 33%.</p><img src="/assets/images/2020/braccio_gazebo_analysis_2.png" alt="Success vs failure counts" /><p> At first, I assumed that there were probably consistent regions where it was failing, but after plotting the start positions of each, I couldn't see any real pattern.</p><img src="/assets/images/2020/braccio_gazebo_analysis_3.png" alt="Success vs failure locations" /><p> As you can see from this longer video there are a lot of ways to mess up.</p><iframe width="560" height="315" src="https://www.youtube.com/embed/uwx_z1y-S3I" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe><p> After a little more digging, it became clear that the main problem was the sliding phase. Since the range of motion is so constrained there were only two narrow bands where the pick up was successful. So if the block starts outside of that area, it needs to be slid back into that area first. For the successful attempts, they all get into the pickup range correctly. In the figure on the right, you can see the two areas where the arm can reach to pick up.</p><img src="/assets/images/2020/braccio_gazebo_analysis_4.png" alt="Success locations top vs side" /><p> For a little more analysis check out <a href="https://github.com/lots-of-things/braccio_moveit_gazebo/blob/main/braccio_moveit_gazebo/scripts/results_analysis.ipynb">this notebook</a>.</p><h4>Next steps</h4><p> I could definitely optimize this further, but I figured it would be more valuable to wait until I have a more specific environment for my <a href="/su_chef.html"><code>su_chef</code> design</a>. But I figured I'd release this playground package for Arduino and ROS hackers like me to work with.</p><p> If you are interest in making it work better, always feel free to <a href="https://viewfoil.bonkerfield.org/">contact me</a> or submit issues and pull requests<a href="https://github.com/lots-of-things/braccio_moveit_gazebo">on Github</a>. And if you want to hear more about <code>su_chef</code> and my dream to start a worker-owned automated foodtruck follow me on <a href="https://twitter.com/bonkerfield">Twitter</a> or check out my newsletter below for updates.</p></div></div></div><div class="section-padding--none"><div class="grid"><hr class="sep" /></div></div><div class="section-padding"><div class="grid-small"><h3 class="post__discussion">Discussion Around the <a href="https://indieweb.org/Webmention">Web</a></h3><div id="webmentions"></div><hr style="margin: 5px 0;" class="sep" /><p>Join the Conversation</p><form target="_blank" name="tweet" action="https://twitter.com/share" method="get"> <input type="hidden" name="original_referer" value="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"> <input type="hidden" name="source" value="bonkerfield"> <textarea style="border-color:#aaa;" id="textar" name="text" maxlength="140"></textarea> <input type="hidden" name="url" value="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"> <button class="btn btn-sm btn-social btn-tw" type="submit" id="button"> <i class="fab fa-twitter"></i> <br/>comment by tweet </button> </form><hr style="margin: 5px 0;" class="sep" /> <form target="_blank" name="tweet" action="https://www.reddit.com/submit" method="get"> <input type="hidden" name="source" value="bonkerfield"> <textarea style="border-color:#aaa;" id="textar" name="title" maxlength="140"></textarea> <button class="btn btn-sm btn-social btn-rd" type="submit" id="button"> <i class="fab fa-reddit-alien"></i> <br/>submit to reddit </button> <input type="hidden" name="url" value="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"> </form> <script src="/assets/js/webmention.min.js"></script></div></div></article></div><section class="related section-padding"><div class="grid-xlarge"><h2 class="related__title">Related</h2><div class="related__container"><article class="related__post"> <a class="related__link" href="https://bonkerfield.org/2020/09/su-chef-slices/"><figure class="related__img"> <img src="/assets/images/2020/suchef_overhead.jpg" alt="su_chef slices" /></figure><div><h2 class="related__text">su_chef slices</h2></div></a></article><article class="related__post"> <a class="related__link" href="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"><figure class="related__img"> <img src="/assets/images/2020/braccio_pick_demo.gif" alt="Simulating the Braccio robotic arm with ROS and Gazebo" /></figure><div><h2 class="related__text">Simulating the Braccio robotic arm with ROS and Gazebo</h2></div></a></article><article class="related__post"> <a class="related__link" href="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"><figure class="related__img"> <img src="/assets/images/2020/yolo_veggie_still.png" alt="Updating su_chef object detection with custom trained model" /></figure><div><h2 class="related__text">Updating su_chef object detection with custom trained model</h2></div></a></article></div></div></section></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Subscribe</span><p class="subscribe__text">Get an update when I post new content.</p><form method="POST" action="https://bonkerfield.us4.list-manage.com/subscribe/post-json?u=68d1146ea8fe327def203f254&amp;id=e88ba623c5&amp;c=?" id="mc-signup" name="mc-embedded-subscribe-form" novalidate><div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_68d1146ea8fe327def203f254_e88ba623c5" tabindex="-1" value=""></div><div class="form-group"> <input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Email Address"></div><div class="form__btn"> <input id="mc-submit" type="submit" value="Sign Up" name="subscribe"></div></form><p class="subscribe__error hidden"></p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__social"><li><a href="https://twitter.com/bonkerfield" rel="me" target="_blank"><i class="fab fa-twitter"></i></a></li><li><a href="https://www.linkedin.com/in/willstedden" rel="me" target="_blank"><i class="fab fa-linkedin"></i></a></li><li><a href="https://github.com/stedn" rel="me" target="_blank"><i class="fab fa-github"></i></a></li><li><a href="https://codepen.io/stedn/" rel="me" target="_blank"><i class="fab fa-codepen"></i></a></li><li><a href="https://www.reddit.com/user/bonkerfield" rel="me" target="_blank"><i class="fab fa-reddit-alien"></i></a></li><li><a href="https://fosstodon.org/@bonkerfield" rel="me" target="_blank"><i class="fab fa-mastodon"></i></a></li><li><a href="https://www.are.na/will-stedden" rel="me" target="_blank"><svg height='16px' id='svg4' inkscape:version='1.0.1 (1.0.1+r75)' sodipodi:docname='arena.svg' version='1.1' viewBox='0 0 150.38 88.986' xmlns='http://www.w3.org/2000/svg' xmlns:cc='http://creativecommons.org/ns#' xmlns:dc='http://purl.org/dc/elements/1.1/' xmlns:inkscape='http://www.inkscape.org/namespaces/inkscape' xmlns:rdf='http://www.w3.org/1999/02/22-rdf-syntax-ns#' xmlns:sodipodi='http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd' xmlns:svg='http://www.w3.org/2000/svg'><metadata id='metadata10'> <rdf:RDF> <cc:Work rdf:about=''> <dc:format>image/svg+xml</dc:format> <dc:type rdf:resource='http://purl.org/dc/dcmitype/StillImage'/> <dc:title/> </cc:Work> </rdf:RDF> </metadata> <defs id='defs8'/> <sodipodi:namedview bordercolor='#666666' borderopacity='1' gridtolerance='10' guidetolerance='10' id='namedview6' inkscape:current-layer='svg4' inkscape:cx='52.509912' inkscape:cy='50.941261' inkscape:pageopacity='0' inkscape:pageshadow='2' inkscape:window-height='719' inkscape:window-maximized='1' inkscape:window-width='1366' inkscape:window-x='0' inkscape:window-y='25' inkscape:zoom='6.203223' objecttolerance='10' pagecolor='#ffffff' showgrid='false'/><path d='M148.93 62.356l-20.847-16.384c-1.276-1-1.276-2.642 0-3.645l20.848-16.38c1.28-1.002 1.815-2.695 1.19-3.76-.626-1.062-2.374-1.44-3.88-.84l-24.79 9.874c-1.507.606-2.927-.22-3.153-1.83L114.57 2.926C114.34 1.317 113.13 0 111.877 0c-1.247 0-2.456 1.317-2.68 2.925l-3.73 26.467c-.228 1.61-1.646 2.434-3.155 1.83l-24.38-9.71c-1.512-.602-3.975-.602-5.483 0l-24.384 9.71c-1.508.604-2.928-.22-3.154-1.83L41.186 2.925C40.956 1.317 39.748 0 38.5 0c-1.252 0-2.463 1.317-2.688 2.925l-3.73 26.467c-.226 1.61-1.645 2.434-3.153 1.83L4.14 21.35c-1.507-.603-3.252-.223-3.878.838-.625 1.066-.092 2.76 1.184 3.76l20.85 16.38c1.277 1.003 1.277 2.645 0 3.646L1.446 62.356C.166 63.358-.364 65.152.26 66.34c.627 1.19 2.372 1.668 3.877 1.064l24.567-9.866c1.51-.603 2.914.218 3.125 1.828l3.544 26.696c.214 1.607 1.618 2.923 3.12 2.923 1.5 0 2.905-1.315 3.12-2.923l3.55-26.696c.21-1.61 1.62-2.43 3.122-1.828l24.164 9.698c1.506.606 3.97.606 5.477 0l24.16-9.698c1.504-.603 2.91.218 3.125 1.828l3.55 26.696c.212 1.607 1.617 2.923 3.115 2.923 1.502 0 2.907-1.315 3.12-2.923l3.55-26.696c.216-1.61 1.62-2.43 3.124-1.828l24.57 9.866c1.5.604 3.25.125 3.876-1.063.627-1.186.094-2.98-1.185-3.982zM95.89 46.18L77.53 60.315c-1.285.99-3.393.99-4.674 0L54.49 46.18c-1.284-.99-1.294-2.62-.02-3.625l18.4-14.493c1.274-1.005 3.363-1.005 4.638 0l18.4 14.493c1.277 1.004 1.267 2.634-.02 3.626z' id='path2' style='fill:#ffffff'/> </svg></a></li></ul><form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank"> <input type="hidden" name="cmd" value="_donations" /> <input type="hidden" name="business" value="3LHDHWRBWMGZA" /> <input type="hidden" name="item_name" value="Help Fund the Quantum Multiverse Bifurcator" /> <input type="hidden" name="currency_code" value="USD" /> <input type="submit" value="donate" name="submit" style="width:15%;min-width:70px;"> <img alt="" border="0" src="https://www.paypal.com/en_US/i/scr/pixel.gif" width="1" height="1" /> </form><div class="posts__pagination"> <span>All content on this blog is free to use under a creative commons <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> license</span></div></div></div></footer><script src="/assets/js/app.min.js"></script> <script> (function() { var links = document.getElementsByTagName('a'); for (var i = 0; i < links.length; i++) { if (/^(http?:)?\/\//.test(links[i].getAttribute('href'))) { links[i].target = '_blank'; } } })(); </script></body></html>
  